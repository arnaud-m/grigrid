#!/usr/bin/octave -qf
###################################################
#     Copyright (C) 2011 Arnaud Malapert.
#
#     This program is free software: you can redistribute it and/or modify                    
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This program is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
###################################################


1; #not a function file

##--------------------------------------------------------------------
## Setup variables and functions
##--------------------------------------------------------------------

 global VERSION="0.1"

 function _version()
   global VERSION;
   printf("%s %s\n", program_name(), VERSION);
   disp("Copyright (C) 2011 Arnaud Malapert");
   disp("License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>.");
   disp("This  is free software: you are free to change and redistribute it.  There is NO WARRANTY, to the extent permitted by law.");
   disp("\n\nWritten by A. Malapert.") ;
 endfunction

function _help()
  printf("%s produces a table on standard output which summarizes the results files.", program_name());
    disp("It requires at least one result file RES.")
  
  disp("\n\tUsage: gridlplot [OPTION]... RES... \n")
  disp("Options:")
  disp("\t--help        display this help and exit")
  disp("\t--version     output version information and exit");
          
  disp("\n\nReport bugs to <malapert (dot) arnaud (at) gmail (dot) com>.")
endfunction

function str=sprintDuration(time)
time=floor(time);
sec= mod(time,60);
time=(time - sec)/60;
min=mod(time,60);
time=(time - min)/60;
hour=mod(time,24);
day=(time - hour)/24;
str=sprintf("Total computation time : %i days, %i hours, %i minutes and %i seconds.", day, hour, min, sec);
endfunction

##--------------------------------------------------------------------
## Test for prerequisites
##--------------------------------------------------------------------
args = argv ();
if( nargin > 0)
  if(strcmp(args{1},"--version"))
    _version();
    exit(0);
  elseif(strcmp(args{1},"--help"))
    _help();
    exit(0);
  endif
endif

if(nargin<1)
  _help();
  error("This octave script takes at least one argument.");
endif

source('~/.grigrid/libgrigrid.m');
##--------------------------------------------------------------------
## Do something
##--------------------------------------------------------------------
labelFormat="%-12s |%8s |%12s |%12s |%8s |%8s\n";
rowFormat="%-12s |%8i |%12.1f |%12.1f |%8i |%8i\n";

totalTime=0;
args=argv();
cpt=0;
##Loop over result files and generate gnuplot data
printf(labelFormat, "Algorithm", "#OPT_CP", "mean(t)", "mean(#bck)", "#OPT_H", "#SAT")
for i = 1:nargin
  M=fread(args{i});
  O= findOPT(M);
  OCP= findOPT_CP( O, M);
  SAT=findSAT(M);
  printf(rowFormat, basename(args{i}), length(OCP), mean(M(OCP, TIME)), mean(M(OCP, BCK)), length(O) - length(OCP), length(SAT))
  totalTime += sum(M(:,TIME)) ;
endfor
disp(sprintDuration(totalTime))


