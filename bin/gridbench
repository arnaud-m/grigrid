#!/bin/sh
###################################################
#     Copyright (C) 2011 Arnaud Malapert.
#
#     This program is free software: you can redistribute it and/or modify                    
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This program is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
###################################################

PROG=`basename $0 .sh`
version() {
cat <<EOF
$PROG 0.1
     
Copyright (C) 2011 Arnaud Malapert.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>.
This  is free software: you are free to change and redistribute it.  There is NO WARRANTY, to the extent permitted by law."
EOF
}

help() {
cat <<EOF
$PROG copies a SOURCE directory and optionally multiple FILE(s), into a non-existing benchmark directory BENCH. \
FILE(s) are copied into each sub-directory of SOURCE.  The copy process create hard links.

Usage: $PROG [OPTION] SOURCE BENCH [FILE]...

Options:
  --help        display this help and exit
  --version     output version information and exit

Report bugs to <malapert (at) i3s (dot) unice (dot) fr>."
EOF
}

#--------------------------------------------------------------------
# Setup Global Variables
#--------------------------------------------------------------------


#--------------------------------------------------------------------
# Test for prerequisites
#--------------------------------------------------------------------

if [ $# -eq 0 ] || [ $1 = "--help" ]; then
    help
    exit 0
elif [ $1 = "--version" ]; then
    version
    exit 0
elif [ $# -eq 1 ] ; then
    help
    exit 2
fi


#--------------------------------------------------------------------
# Do something
#--------------------------------------------------------------------

SOURCE=$1
shift
DEST=$1
shift
if [ -d  $SOURCE ]; then
    if [ -e $DEST ]; then
	echo "$DEST exists already.";
	exit 1;
    else
        #copy directory SOURCE into DEST using hard links;
	cp -al $SOURCE $DEST
        #create hard links to FILES in each sub-directory of DEST 
        #it seems more complicated to create symbolic links 
	if [ -n "$*" ]; then
 	    find $DEST -type d -exec ln -f -t '{}' $*  \;
	else
	    echo "[WARN] No additional file to link.";
	fi
    fi     
else
    echo "No instances directory: $SOURCE";
    exit 1;
fi


