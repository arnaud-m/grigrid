#!/bin/sh
###################################################
#     Copyright (C) 2011 Arnaud Malapert.
#
#     This program is free software: you can redistribute it and/or modify                    
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This program is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
###################################################

PROG=`basename $0 .sh`
version() {

    echo  "$PROG 0.1
     
Copyright (C) 2011 Arnaud Malapert.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>.
This  is free software: you are free to change and redistribute it.  There is NO WARRANTY, to the extent permitted by law.
     
Written by A. Malapert."
}

help() {
echo "$0 convert a file PROP (.properties) into a dictionnary file PROP (.dict) created in the current directory.
     
Usage: $0 [OPTION]... PROP
     
Options:
  --help        display this help and exit
  --version     output version information and exit
     
Report bugs to <malapert (dot) arnaud (at) gmail (dot) com>."
}

#--------------------------------------------------------------------
# Setup Global Variables
#--------------------------------------------------------------------


#--------------------------------------------------------------------
# Test for prerequisites
#--------------------------------------------------------------------

if [ $# -eq 0 ] || [ $1 = "--help" ]; then
    help
    exit 0
elif [ $# -ne 1 ]; then
    help exit 1
elif [ $1 = "--version" ]; then
    version
    exit 0
fi


#--------------------------------------------------------------------
# Do something
#--------------------------------------------------------------------

DICT=`basename $1 .properties`.dict

#remove comments, add space before =, remove blank lines, duplicates optimal values, replace character ':' for non optimal values  
sed -e 's/^\s*\([^\#]*\).*/\1/'  -e 's/\s*=\s*/ |/'< $1 | \
sed  -e '/^$/d'  -e 's/^\(.*\) |\([0-9][0-9]*\)\s*$/\1 |\2|\2/'  |\
tr ':' '|' > $DICT

